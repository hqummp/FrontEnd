<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>居民诉求管理系统</title><!-- Bootstrap Styles-->
<link href="assets/css/bootstrap.css" rel="stylesheet"/>
<!-- FontAwesome Styles-->
<link href="assets/css/font-awesome.css" rel="stylesheet"/>
<!-- Morris Chart Styles-->
<link href="assets/js/morris/morris-0.4.3.min.css" rel="stylesheet"/>
<!-- Custom Styles-->
<link href="assets/css/custom-styles.css" rel="stylesheet"/>
<link href="assets/css/datepicker.css" rel="stylesheet">
<link href="assets/css/message.css" type="text/css" rel="stylesheet">
<!-- Google Fonts-->
<link href='http://fonts.googleapis.com/css?family=Open+Sans' rel='stylesheet' type='text/css'/>
</head>
<body>
<div id="wrapper">
	<nav class="navbar navbar-default top-navbar" role="navigation">
	<div class="navbar-header">
		<a class="navbar-brand" href="index.html">管理系统</a>
	</div>
	<ul class="nav navbar-top-links navbar-right">
		<li class="dropdown">
		<a class="dropdown-toggle" data-toggle="dropdown" href="#" aria-expanded="false">
		<i class="fa fa-user fa-fw"></i><i class="fa fa-caret-down"></i>
		</a>
		<ul class="dropdown-menu dropdown-user">
			<li><a href="#"><i class="fa fa-user fa-fw"></i> admin</li>
			<li><a href="#"><i class="fa fa-sign-out fa-fw"></i> Logout</a>
			</li>
		</ul>
		</li>
	</ul>
	</nav>
	<nav class="navbar-default navbar-side" role="navigation">
	<div class="sidebar-collapse">
		<ul class="nav" id="main-menu">
			<li>
			<a href="index.html"><i class="fa fa-dashboard"></i> 总览</a>
			</li>
			<li>
			<a class="active-menu" href="form.html"><i class="fa fa-edit"></i> 信息提交</a>
			</li>
			<li>
			<a href="table.html"><i class="fa fa-table"></i> 综合查询</a>
			</li>
			<li>
			<a href="chart.html"><i class="fa fa-bar-chart-o"></i> 图表</a>
			</li>
			<li>
			<a href="#"><i class="fa fa-sitemap"></i> 事件分类查询<span class="fa arrow"></span></a>
			<ul class="nav nav-second-level">
				<li>
				<a href="issues/city-management.html">城市管理</a>
				</li>
				<li>
				<a href="issues/planning-construction.html">规划建设</a>
				</li>
				<li>
				<a href="issues/house-removal.html">征地拆迁</a>
				</li>
				<li>
				<a href="issues/contract-dispute.html">合同纠纷</a>
				</li>
				<li>
				<a href="issues/property-management.html">物业管理</a>
				</li>
				<li>
				<a href="issues/environment-protection.html">环境保护</a>
				</li>
				<li>
				<a href="issues/social-affairs.html">社会事务</a>
				</li>
				<li>
				<a href="issues/public-security.html">社会治安</a>
				</li>
				<li>
				<a href="issues/staff-administration.html">干部管理</a>
				</li>
				<li>
				<a href="issues/general-election.html">换届选举</a>
				</li>
			</ul>
			</li>
			<li>
			<a href="#"><i class="fa fa-sitemap"></i> 平台分类查询<span class="fa arrow"></span></a>
			<ul class="nav nav-second-level">
				<li>
				<a href="platform/mayor-phone.html">市长公开电话</a>
				</li>
				<li>
				<a href="platform/mayor-mailbox.html">市长信箱</a>
				</li>
				<li>
				<a href="platform/new-web.html">网络新媒体</a>
				</li>
				<li>
				<a href="platform/warden-mailbox.html">区长信箱</a>
				</li>
				<li>
				<a href="platform/renmin-website.html">人民网</a>
				</li>
				<li>
				<a href="platform/hotline.html">文明热线</a>
				</li>
				<li>
				<a href="platform/web-politic.html">网络理政</a>
				</li>
			</ul>
			</li>
		</ul>
	</div>
	</nav>
	<div id="page-wrapper">
		<div id="page-inner">
			<div class="row">
				<div class="col-md-12">
					<h1 class="page-header">
                            信息提交
					</h1>
				</div>
			</div>
			<!-- /. ROW  -->
			<div class="row">
				<div class="col-lg-12">
					<div class="panel panel-default">
						<div class="panel-heading">
                            居民诉求信息提交
						</div>
						<div class="panel-body">
							<div class="row">
								<div class="col-lg-6">
                                    <h4>反应相关分类信息</h4>
									<form role="form">
										<div class="form-group">
                                            <!--<p class="help-block">
												请填写日期
											</p>-->
                                            <label>请填写日期</label>
                                            <br/>
                                            <div id="timepicker" class="c-datepicker-date-editor c-datepicker-single-editor J-datepicker-day mt10">
                                                <i class="c-datepicker-range__icon kxiconfont icon-clock"></i>
                                                <input type="text" autocomplete="off" name="" placeholder="选择日期" class=" c-datepicker-data-input only-date" value="">
                                            </div>
										</div>
                                        <div class="form-group">
											<label>反应平台</label>
											<select id="source-select" class="form-control">
                                                <option>市长公开电话</option>
                                                <option>市长信箱</option>
                                                <option>网络新媒体</option>
                                                <option>区长信箱</option>
                                                <option>人民网</option>
                                                <option>文明办</option>
                                                <option>网络理政信箱督办单</option>
                                            </select>
										</div>
                                        <div class="form-group">
											<label>反应问题</label>
											<select id="issue-select" class="form-control">
                                                <option>环境保护</option>
                                                <option>城市管理</option>
                                                <option>社会事务</option>
                                                <option>规划建设</option>
                                                <option>征地拆迁</option>
                                                <option>物业管理</option>
                                                <option>干部管理</option>
                                                <option>合同纠纷</option>
                                                <option>社会治安</option>
                                                <option>换届选举</option>
                                            </select>
										</div>
										<div class="form-group">
											<label>附加标签</label>
											<input id="subcategory" class="form-control" placeholder="子问题">
										</div>
									</form>
                                    <button id="submit" type="submit" class="btn btn-primary btn-lg">提交</button>
                                    <button id="reset" type="reset" class="btn btn-default btn-lg">重置</button>
								</div>
								<!-- /.col-lg-6 (nested) -->
								<div class="col-lg-6">
									<h4>反应内容填写</h4>
									<form role="form">
                                        <div class="form-group">
											<label>反应内容</label>
											<textarea id="form-content" class="form-control" rows="2"></textarea>
										</div>
                                        <div class="form-group">
											<label>详细信息</label>
											<textarea id="form-info" class="form-control" rows="4"></textarea>
										</div>
                                        <div class="form-group">
											<label>备注</label>
											<textarea id="form-remark" class="form-control" rows="1"></textarea>
										</div>
									</form>
								</div>
								<!-- /.col-lg-6 (nested) -->
							</div>
							<!-- /.row (nested) -->
						</div>
						<!-- /.panel-body -->
					</div>
					<!-- /.panel -->
				</div>
				<!-- /.col-lg-12 -->
			</div>
			<footer>
			<p>
				All right reserved. LR Workshop&copy;
			</p>
			</footer>
		</div>
		<!-- /. PAGE INNER  -->
	</div>
	<!-- /. PAGE WRAPPER  -->
</div>
<!-- /. WRAPPER  --><!-- JS Scripts--><!-- jQuery Js -->
<script src="assets/js/jquery-1.10.2.js"></script>
<!-- Bootstrap Js -->
<script src="assets/js/bootstrap.min.js"></script>
<!-- Metis Menu Js -->
<script src="assets/js/jquery.metisMenu.js"></script>
<!-- Custom Js -->
<script src="assets/js/custom-scripts.js"></script>
<script src="assets/js/moment.min.js"></script>
<script type="text/javascript" src="assets/js/message.js"></script>
<script src="assets/js/datepicker.all.min.js"></script>
<script>
var selected_time = [];

$(function () {
	$("#submit").click(function () {
		let source = $("#source-select").find("option:selected").text(),
			category = $("#issue-select").find("option:selected").text(),
			subcategory = "null",
			title = "null",
			subtitle = "null",
			content = $("#form-content").val(),
			detail = $("#form-info").val() || "null",
			remark = $("#form-remark").val() || "null",
			level = 1;
		if (selected_time.length === 3 && content !== "") {
			$.ajax({
				type: "POST",
				url: "http://127.0.0.1:3000/new",
				dataType: "json",
				data: {
					"data": JSON.stringify({
						"year": selected_time[0],
						"month": selected_time[1],
						"day": selected_time[2],
						"source": $("#source-select").find("option:selected").text(),
						"category": $("#issue-select").find("option:selected").text(),
						"subcategory": "null",
						"title": "null",
						"subtitle": "null",
						"content": $("#form-content").val(),
						"detail": $("#form-info").val() || "null",
						"remark": $("#form-remark").val() || "null",
						"level": 1
					})
				},
				success: function (result) {
					console.log(result);
					$.message("提交成功");
					setTimeout(function () {
						window.location.reload();
					}, 3000);
				}
			});
		} else {
			$.message({
				message:'至少填写时间和反映内容',
				type:'warning'
			});
		}
	});

	$("#reset").click(function () {
		$("#subcategory").val("");
		$("#form-content").val("");
		$("#form-info").val("");
		$("#form-remark").val("");
	});
});

$(function() {
	var DATAPICKERAPI = {
		// 默认input显示当前月,自己获取后填充
		activeMonthRange: function() {
			return {
				begin: moment().set({
					'date': 1,
					'hour': 0,
					'minute': 0,
					'second': 0
				}).format('YYYY-MM-DD HH:mm:ss'),
				end: moment().set({
					'hour': 23,
					'minute': 59,
					'second': 59
				}).format('YYYY-MM-DD HH:mm:ss')
			}
		},
		shortcutMonth: function() {
			// 当月
			var nowDay = moment().get('date');
			var prevMonthFirstDay = moment().subtract(1, 'months').set({
				'date': 1
			});
			var prevMonthDay = moment().diff(prevMonthFirstDay, 'days');
			return {
				now: '-' + nowDay + ',0',
				prev: '-' + prevMonthDay + ',-' + nowDay
			}
		},
		// 注意为函数：快捷选项option:只能同一个月份内的
		rangeMonthShortcutOption1: function() {
			var result = DATAPICKERAPI.shortcutMonth();
			return [{
				name: '昨天',
				day: '-1,-1',
				time: '00:00:00,23:59:59'
			}, {
				name: '这一月',
				day: result.now,
				time: '00:00:00,'
			}, {
				name: '上一月',
				day: result.prev,
				time: '00:00:00,23:59:59'
			}];
		},
		// 快捷选项option
		rangeShortcutOption1: [{
			name: '最近一周',
			day: '-7,0'
		}, {
			name: '最近一个月',
			day: '-30,0'
		}, {
			name: '最近三个月',
			day: '-90, 0'
		}],
		singleShortcutOptions1: [{
			name: '今天',
			day: '0'
		}, {
			name: '昨天',
			day: '-1',
			time: '00:00:00'
		}, {
			name: '一周前',
			day: '-7'
		}]
	};

	$('.J-datepicker-day').datePicker({
		hasShortcut: true,
		format: 'YYYY-MM-DD',
		shortcutOptions: [{
			name: '今天',
			day: '0'
		}, {
			name: '昨天',
			day: '-1'
		}, {
			name: '一周前',
			day: '-7'
		}],
		hide: function() {
			selected_time = this.$input.eq(0).val().split('-');
			console.info(this.$input.eq(0).val().split('-'));
		}
	});
});
</script>
</body>
</html>
